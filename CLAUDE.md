# AI Trends Dashboard

## Database Rule

When adding or modifying sources (or any schema/data change), always apply
the change to the live Supabase database in addition to creating migration
files and updating setup scripts. Migration files do not auto-apply.

## Documentation Update Rule

After any structural change, update both:
1. `docs/product-spec.md` — reflect the change in the spec
2. `docs/architecture.png` — regenerate the diagram from `docs/architecture.mmd`

"Structural change" includes: workflow steps added/removed, new workflows,
rule changes, file structure changes, new dependencies, new API endpoints,
error-handling strategy changes, data-pipeline behavior changes (caching,
polling, fetch logic), and new diagnostic/debug facilities. When in doubt,
update the docs — a redundant docs update costs nothing; a missing one
accumulates drift.

## Verification Rule

After completing a development task, verify the changes work by launching
the dev server and testing via Playwright (browser snapshot / screenshot).
Check that affected pages render correctly and new UI elements appear as
expected. After verification, delete any temporary `.png` screenshots
generated by Playwright (e.g. in `.playwright-mcp/`) before committing.

## Skills

Before any task, consult the skills-index.json referenced in the global CLAUDE.md to find applicable skills by matching tags and descriptions to the task at hand. Read the matching `SKILL.md` before proceeding.

- `workflows/self-healing/SKILL.md` — Buffer-promote-clear learning system

## Self-Healing

Managed by the `workflows/self-healing` skill. Read the skill when triggered protocols fire.

| Setting | Value |
|---------|-------|
| Buffer file | `learnings.md` |
| Rules file | CLAUDE.md > Promoted Rules |
| Staleness | 60 days |
| Signal alert | 20+ entries |
| Synthesis trigger | 30 days |

**Real-time capture:** Every feedback signal (correction, preference, opinion) must be written to the buffer file BEFORE the next action. Not after the session. Immediately.

**Session start:** Quick-scan buffer file. If 20+ entries, flag bloat. Clear any PROMOTED markers. Spot-check oldest signals against rules file. Check global CLAUDE.md > Global Promotion History — if any promotions in the last 7 days, surface them in a callout:
> **Recent global promotions:** [rule] (from [project], [date])

**Session end:** (1) Scan conversation for uncaptured signals. (2) Encode actionable signals, check 3+ thresholds, apply direct statements. (3) Clear every encoded/promoted signal from buffer. Report count. (4) Summarize: what was produced, learnings captured, self-healing fires, signals cleared.

## Definition of Done (DOD) Checklist

Every implementation plan MUST include these as explicit final steps. Do not
consider a task complete until all applicable gates pass.

- [ ] **Database** — If sources or schema changed: applied to live Supabase (not just migration files)
- [ ] **Docs: product-spec** — If structural change: `docs/product-spec.md` updated
- [ ] **Docs: architecture diagram** — If structural change: `docs/architecture.png` regenerated from `docs/architecture.mmd`
- [ ] **Verification** — Dev server launched, Playwright snapshot confirms UI renders correctly on **every affected page** (not just the primary view — include Settings, detail pages, or any route that displays changed data).
- [ ] **Cleanup** — Temporary Playwright screenshots deleted before commit

Mark gates as "N/A" in the plan when genuinely not applicable. Never silently skip.

## Promoted Rules

<!-- Rules promoted by self-healing. This section grows as the system learns. -->

- **KPI card design principle.** Dashboard KPI cards must be designed for a time-constrained manager deciding where to focus reading. Every KPI must answer "where should I spend my reading time?" — not just display a metric. (Promoted 2026-02-22)
